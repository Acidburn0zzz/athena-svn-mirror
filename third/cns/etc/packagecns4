#!/bin/sh
# make all of the packages and clean out the tree
host=$1
if [ ! -d $host ]; then
	echo "run this script above the kerberos and build directories"
	echo "or run buildcns4 $host first"
	exit 1
fi
cd $host
(time make taz-bin; time make svr4-pkg) 2>&1 | tee pkg-log-`date +%y%m%d%H%M`
if [ ! -r ../cns4-src.taz ] ; then
	(time make taz-src) 2>&1| tee pkg-src-log-`date +%y%m%d%H%M`
	mv pkgdir/cns4-src.taz ../cns4-src.taz
fi
hostos=`echo $host | sed 's/^[^-]*-//'`
mv cns4-bin.taz ../$host-cns4-bin.taz
if [ -r pkgdir/CNS4.pkg ] ; then
	mv pkgdir/CNS4.pkg ../$host-CNS4.pkg
	mv pkgdir/CNS4-SRC.pkg ../$host-CNS4-SRC.pkg
fi
(time make clean) 2>&1 | tee clean-log-`date +%y%m%d%H%M`
cd ..
for i in cns4-bin.taz CNS4-SRC.pkg CNS4.pkg; do
	if [ -r $host-$i ] ; then
		ln -s $host-$i $hostos-$i
		ls -al $host-$i $hostos-$i
	fi
done
