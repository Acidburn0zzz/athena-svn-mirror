#
# Copyright (c) 1993 Michael A. Cooper
# Copyright (c) 1993 Regents of the University of California.
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#	This product includes software developed by the University of
#	California, Berkeley and its contributors.
# 4. Neither the name of the University nor the names of its contributors
#    may be used to endorse or promote products derived from this software
#    without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
# FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
# OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
# HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
# LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
# OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.
#
# $Id: Makefile.in,v 1.1.1.1 1996-09-06 00:46:15 ghudson Exp $
#

srcdir=@srcdir@
VPATH=@srcdir@
# @makefile_frag@

IN_ARGS		= -g ${BIN_GROUP}

HFILES		= $(srcdir)/../config/config.h $(srcdir)/../config/config-data.h \
			$(srcdir)/../config/config-def.h $(srcdir)/../config/os-$(OS).h \
			$(srcdir)/../include/defs.h $(srcdir)/../include/filesys.h \
			$(srcdir)/../include/pathnames.h $(srcdir)/../include/paths.h \
			$(srcdir)/../include/version.h
COMMONOBJS	= $(O)common.o $(O)message.o $(O)setargs.o
COMMONSRCS	= common.c message.c setargs.c
CLIENTOBJS 	= $(O)gram.o $(O)rdist.o $(O)client.o $(O)child.o $(O)docmd.o \
			$(O)distopt.o $(O)expand.o $(O)lookup.o \
			$(O)isexec.o $(O)signal.o $(O)rshrcmd.o
CLIENTSRCS 	= gram.c rdist.c client.c child.c docmd.c \
			distopt.c expand.c lookup.c \
			isexec.c signal.c rshrcmd.c
SERVEROBJS	= $(O)rdistd.o $(O)server.o $(O)filesys.o $(O)filesys-os.o
SERVERSRCS	= rdistd.c server.c filesys.c filesys-os.c

OS_H		= os-$(OS).h
DEFS		= -DOS_H=\"$(OS_H)\" $(DEFS_SYS) $(DEFS_LOCAL) \
			-DPATH_KRB_REMSH=\"$(prefix)/bin/rsh\"
LIBS		= $(LIB_SYS) $(LIBS_LOCAL)
CFLAGS		= $(OPT) $(DEFS) $(INCLUDE) $(CFLAGS_OS)

INCLUDE		= -I. -I$(srcdir) -I$(srcdir)/../include -I$(srcdir)/../config \
			$(OTHERINCS) $(INCLUDE_SYS)

CLIENT_BIN	= $(O)$(CLIENT)
SERVER_BIN	= $(O)$(SERVER)

all: src

src: $(CLIENT_BIN) $(SERVER_BIN)

$(SERVER_BIN): $(SERVEROBJS) $(COMMONOBJS) $(MISSINGOBJS)
	$(CC) -o $@ $(SERVEROBJS) $(COMMONOBJS) $(MISSINGOBJS) $(LIBS)

$(CLIENT_BIN): $(CLIENTOBJS) $(COMMONOBJS) $(MISSINGOBJS)
	$(CC) -o $@ $(CLIENTOBJS) $(COMMONOBJS) $(MISSINGOBJS) $(LIBS)

$(CLIENTOBJS) $(SERVEROBJS): $(HFILES) y.tab.h

# This dependency is needed to make Sunos make aware of the sources at
# the other end of the vpath. The name is not significant.
MISSINGSRCS=strerror.c strcasecmp.c strdup.c vsprintf.c strtol.c hasmntopt.c \
	regex.c
SRCS=$(CLIENTSRCS) $(COMMONSRCS) $(SERVERSRCS) $(MISSINGSRCS)
vdepend: $(SRCS)

gram.c y.tab.h: gram.y
	rm -f gram.c y.tab.h
	yacc -d $(srcdir)/gram.y
	mv -f y.tab.c gram.c

clean mostlyclean:
	rm -f ${CLEANFILES} gram.c *.o \
		$(CLIENT_BIN) $(SERVER_BIN) \
		$(CLIENTOBJS) $(SERVEROBJS) \
		$(COMMONOBJS) $(MISSINGOBJS)

distclean realclean: clean
	rm -f Makefile

USRDIR=$(prefix)
PROGDIR=$(USRDIR)/bin

install: $(CLIENT_BIN) $(SERVER_BIN)
	$(INSTALL) $(CLIENT_BIN) ${DESTDIR}$(PROGDIR)/krdist
	$(INSTALL) $(SERVER_BIN) ${DESTDIR}$(PROGDIR)/rdistd

install.man:
