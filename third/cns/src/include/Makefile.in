#### include configury here
##DOS!include ..\config\common
##DOS!include ..\config\mt-win
BUILDTOP=$(C)$(S)$(U)

UHFILES	= \
	des.h \
	kadm.h \
	kerberos.h \
	kstream.h \
	mit-copyright.h \
	osconf.h \
	krbports.h \
	c-386aix.h \
	c-rs6000.h \
	c-alpha.h \
	c-aux.h \
	c-sun386i.h \
	c-apollo.h \
	c-rtpc.h \
	c-sun3.h \
	c-sunos4.h \
	c-tahoe.h \
	c-vax.h \
	c-hp68k.h \
	c-hpsnake.h \
	c-ibm370.h \
	c-386linux.h \
	c-386bsd.h \
	c-next.h \
	c-pc.h \
	c-pyr.h \
	c-386sco.h \
	c-sgi.h \
	c-sol2.h \
	c-ultmips.h \
	conf.h	\
	cc-unix.h

GUHFILES = \
	kdc.h \
	klog.h \
	krb_db.h \
	krb.h

KHFILES	= \
	conf.h \
	kparse.h \
	krb_conf.h \
	principal.h \
	prot.h \
	lsb_addr_cmp.h

ETHFILES = \
	kadm_err.h \
	krb_err.h

HFILES=$(GUHFILES) $(UHFILES) $(KHFILES) $(ETHFILES)
CODE=$(UHFILES) $(KHFILES) Makefile.in krb-sed.h kdc-sed.h klog-sed.h

all:: all-$(WHAT)

all-unix:: $(HFILES)

all-windows::
	copy krb-sed.h krb.h
	copy krb_db-sed.h krb_db.h

# On Unix, for the Windows port, build the things we need to use `sed' for.
unixdos: $(GUHFILES)

# On Unix, for the Mac port, build the things we need to use `sed' for.
unixmac: $(GUHFILES)

krb.h:	krb-sed.h
	$(RM) krb.h
	sed -e 's*CONFDIR*$(CONFDIR)*g' -e 's*SRVTAB_FILE*$(SRVTAB_FILE)*g' -e 's*SITE_KRB_REALM*$(SITE_KRB_REALM)*g' < $(srcdir)/krb-sed.h > krb.h

kdc.h:	kdc-sed.h
	$(RM) kdc.h
	sed -e 's*KLOGDIR*$(KLOGDIR)*g' -e 's*KDBDIR*$(KDBDIR)*g' < $(srcdir)/kdc-sed.h > kdc.h

krb_db.h:	krb_db-sed.h
	$(RM) krb_db.h
	sed -e 's*KDBDIR*$(KDBDIR)*g' < $(srcdir)/krb_db-sed.h > krb_db.h

klog.h:	klog-sed.h
	$(RM) klog.h
	sed -e 's*KLOGDIR*$(KLOGDIR)*g' < $(srcdir)/klog-sed.h > klog.h

krb_err.h: $(srcdir)/../lib/krb/krb_err.et
	(cd ../lib/krb; $(MAKE) krb_err.h)

kadm_err.h: $(srcdir)/../lib/kadm/kadm_err.et
	(cd ../lib/kadm; $(MAKE) kadm_err.h)

depend:: $(HFILES)

install:: install-$(WHAT)

install-unix::
	-if [ ! -d $(DESTDIR)$(INCLDIR) ]; then mkdir $(DESTDIR)$(INCLDIR); fi
	for i in $(UHFILES); do \
		$(INSTALLFILE) $(srcdir)/$$i $(DESTDIR)$(INCLDIR)/$$i; done
	for i in $(GUHFILES) $(ETHFILES); do \
		$(INSTALLFILE) $$i $(DESTDIR)$(INCLDIR)/$$i; done

install-windows::
	copy winsock.h ..\floppy
	copy kstream.h ..\floppy
	copy conf.h ..\floppy
	copy c-window.h ..\floppy
	copy des.h ..\floppy
	copy kerberos.h ..\floppy
	copy mit-copy.h ..\floppy
	copy osconf.h ..\floppy
	copy krb.h ..\floppy

install-mac::
	-mkdir $(DESTDIR)/include
	cp macsock.h $(DESTDIR)/include
	cp kstream.h $(DESTDIR)/include
	cp conf.h $(DESTDIR)/include
	cp c-mac.h $(DESTDIR)/include
	cp des.h $(DESTDIR)/include
	cp kerberos.h $(DESTDIR)/include
	cp mit-copyright.h $(DESTDIR)/include
	cp osconf.h $(DESTDIR)/include
	cp krb.h $(DESTDIR)/include
	cp krb_driver.h $(DESTDIR)/include
	cp AddressXlation.h $(DESTDIR)/include
	cp GetMyIPAddr.h $(DESTDIR)/include
	cp MacTCPCommonTypes.h $(DESTDIR)/include
	cp TCPPB.h $(DESTDIR)/include
	cp UDPPB.h $(DESTDIR)/include

clean:: clean-$(WHAT)

distclean:: clean
	$(RM) *~ core
	$(RM) Makefile config.status 

clean-unix::
	$(RM) krb.h kdc.h klog.h krb_db.h $(ETHFILES)

clean-windows::
	-del ..\floppy\winsock.h
	-del ..\floppy\kstream.h
	-del ..\floppy\conf.h
	-del ..\floppy\c-window.h
	-del ..\floppy\des.h
	-del ..\floppy\kerberos.h
	-del ..\floppy\mit-copy.h
	-del ..\floppy\osconf.h
	-del ..\floppy\krb.h
