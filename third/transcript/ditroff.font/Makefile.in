# $Header: /afs/dev.mit.edu/source/repository/third/transcript/ditroff.font/Makefile.in,v 1.1 1996-10-14 04:30:17 ghudson Exp $
#
# This is the global Makefile template for TranScript on Athena.
# It does, roughly, the same things as the original build scripts, but
# in a slightly more structured fashion.
#
# PostScript is a registered trademark of Adobe Systems Incorporated
# TranScript is a registered trademark of Adobe Systems Incorporated


# SYSV make is a censored piece of censored...
SHELL = /bin/sh

prefix=@prefix@
exec_prefix=@exec_prefix@
mandir=@mandir@
datadir=@datadir@
PSLIBDIR=${datadir}/ps
TROFFDIR=${PSLIBDIR}/troff.font
DITDIR=${PSLIBDIR}/ditroff.font
PSTEMPDIR=/var/tmp

MAKEDEV=@MAKEDEV@

# programs
SED=sed
AWK=awk
RM=rm -f
LN=ln -s
MKDIR=mkdir
TAR=tar

# available fonts
FONTS_A=Times Helvetica Courier
FONTS_B=AvantGarde Bookman HelvNarrow NewCentury Palatino Zapf
FONTS_X=Garamond Optima Souvenir Lubalin
ALL_FONTS=$(FONTS_A) $(FONTS_B) $(FONTS_X)
# fonts we're actually building.  should start with Times.
FONTS=${ALL_FONTS}

# fonts that will be listed in the DESC file
DESCFONTS=R I B BI H HB C CB S SS

# two-letter font names for each of the font families
Times=TR TI TB TD
Helvetica=H HO HB HD
Courier=C CO CB CD
HelvNarrow=hn hN Hn HN
AvantGarde=ag aG Ag AG
Bookman=bo bO Bo BO
Garamond=ga gA Ga GA
Lubalin=lu lU Lu LU
NewCentury=nc nC Nc NC
Optima=op oP Op OP
Palatino=PA PI PB PX
Souvenir=sv sV Sv SV
Zapf=ZC
# "extra" font names which aren't in any of the families.
EXTRA_DIGRAPHS=CW S SS

# a list of fonts with and without ligatures, respectively
NORMAL_DIGRAPHS=${Times} ${Helvetica} ${HelvNarrow} ${AvantGarde} ${Bookman} \
	${Garamond} ${Lubalin} ${NewCentury} ${Optima} ${Palatino} \
	${Souvenir} ${Zapf} S SS
NO_LIG_DIGRAPHS=${Courier}

.PHONY: all builddit clean install times-dir family directory

all: builddit

builddit: times-dir
	for i in ${FONTS}; do \
		$(MAKE) ${MFLAGS} FAM=$$i FAMILY="\$${$$i}" directory; \
	done

clean:
	$(RM) -r ${ALL_FONTS}

install:
	$(RM) -r ${DESTDIR}${DITDIR}
	$(MKDIR) ${DESTDIR}${DITDIR}
	( $(TAR) cf - ${FONTS} ) | ( cd ${DESTDIR}${DITDIR}; $(TAR) xf - )

## building Times/devpsc

times-dir: Times/devpsc/DESC
	for i in ${FONTS}; do \
		$(MAKE) ${MFLAGS} FAMILY="\$${$$i}" family; \
	done
	cd Times/devpsc; \
	${MAKE} -f ../../Makefile ${MFLAGS} ${EXTRA_DIGRAPHS}

family:
	cd Times/devpsc; \
	${MAKE} -f ../../Makefile ${MFLAGS} ${FAMILY}

Times/devpsc/DESC:
	-$(MKDIR) Times
	-$(MKDIR) Times/devpsc
	echo "# ditroff device description for PostScript" >> $@
	echo "# PostScript is a registered trademark of Adobe Systems Incorporated" >> $@
	echo ${DESCFONTS} | awk '{print "fonts", NF, $$0}' >> $@
	cat ../lib/ditroff.font/devspecs >> $@
	echo "charset" >> $@
	cat ../lib/ditroff.font/charset >> $@

## building */devpsc

directory:
	if [ "${FAM}" != "Times" ]; then \
		$(RM) -r ${FAM};  $(MKDIR) ${FAM};  $(MKDIR) ${FAM}/devpsc; \
		cd ${FAM}/devpsc;  $(LN) ../../Times/devpsc/* .; \
		$(RM) DESC.out R R.* I I.* I.* B B.*  BI BI.*; \
	else : Ultrix sucks; fi
	cd ${FAM}/devpsc; \
	    set ${FAMILY}; \
	    $(RM) R.map R.aux I.map I.aux B.map B.aux BI.map BI.aux; \
	    $(SED) -e "s/^name.*/name R/"  ../../Times/devpsc/$$1      > R; \
	    $(LN) $$1.map      R.map;   $(LN) $$1.aux      R.aux; \
	    $(SED) -e "s/^name.*/name I/"  ../../Times/devpsc/$${2-TR} > I; \
	    $(LN) $${2-TR}.map I.map;   $(LN) $${2-TR}.aux I.aux; \
	    $(SED) -e "s/^name.*/name B/"  ../../Times/devpsc/$${3-TB} > B; \
	    $(LN) $${3-TB}.map B.map;   $(LN) $${3-TB}.aux B.aux; \
	    $(SED) -e "s/^name.*/name BI/" ../../Times/devpsc/$${4-TD} > BI;\
	    $(LN) $${4-TD}.map BI.map;  $(LN) $${4-TD}.aux BI.aux; \
	    $(MAKEDEV) DESC

##### The following dependencies get executed from Times/devpsc sub-directory.

${ALL_FONTS}:
	${MAKE} ${MFLAGS} 

${NORMAL_DIGRAPHS}: DESC
	$(RM) $@ $@.map $@.aux
	cp ../../../lib/ditroff.font/$@.map .
	realname=`head -1 $@.map`; \
	PSRESOURCEPATH="../../../lib::"; export PSRESOURCEPATH; \
		../../../src/afmdit -a  `../../../src/map $$realname` \
		-o $@ -m $@.map -x $@.aux
	${MAKEDEV} $@
${NO_LIG_DIGRAPHS}: DESC
	$(RM) $@ $@.map $@.aux
	cp ../../../lib/ditroff.font/$@.map .
	realname=`head -1 $@.map`; \
	PSRESOURCEPATH="../../../lib::"; export PSRESOURCEPATH; \
		../../../src/afmdit -a  `../../../src/map $$realname` \
		-o $@ -m $@.map -x $@.aux -n
	${MAKEDEV} $@
# no ligatures are generated if the "-n" flag is passed to afmdit.

CW: C
	$(LN) C CW
	$(LN) C.aux CW.aux
	$(LN) C.map CW.map
	$(LN) C.out CW.out

desc: DESC ${DESCFONTS}
	${MAKEDEV} DESC
