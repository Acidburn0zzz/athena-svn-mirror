#!/bin/sh
#
# $Id: mkversion,v 1.1.1.1 1998-12-24 22:02:58 ghudson Exp $
#
PATH=/usr/ucb:/usr/bsd:/usr/bin:/bin
export PATH

outfile=versinfo.c
count=1
num=$#
host="$BUILD_HOST"
user="$BUILD_USER"

while [ "$count" -le "$num" ]; do
    flag=$1
    case $flag in
    '-file')
	shift
	outfile=$1
	count=`expr $count + 1`
	;;
    '-host')
	shift
	host=$1
	count=`expr $count + 1`
	;;
    '-user')
	shift
	user=$1
	count=`expr $count + 1`
	;;
    esac
    if [ "$count" -lt "$num" ]; then
	shift
    fi
    count=`expr $count + 1`
done

if [ -z "$date" ]; then
    date=`date`
fi
if [ -z "$host" ]; then
    host=`hostname`
fi
if [ -z "$user" ]; then
    who=`who am i 2>/dev/null`
    if [ ! -z "$who" ]; then
	user=`echo $who | awk '{print $1}' | sed -e 's;.*!;;'`
    else
	user=""
    fi
fi

OSname=`build/buildinfo -osname -real`
OSver=`build/buildinfo -osver -real`
OStype=`build/buildinfo -osnamemver`
AppArch=`build/buildinfo -apparch`
CPUArch=`build/buildinfo -cpuarch`
KISA=`build/buildinfo -kisa`

rm -f $outfile

cat >$outfile<<EOF
/*
 * WARNING: This file was automatically generated by mkversion.
 */
char BuildDate[] = "$date";
char BuildHost[] = "$host";
char BuildUser[] = "$user";
char BuildOSname[] = "$OSname";
char BuildOSver[] = "$OSver";
char BuildOStype[] = "$OStype";
char BuildAppArch[] = "$AppArch";
char BuildCPUArch[] = "$CPUArch";
char BuildKISA[] = "$KISA";
EOF
