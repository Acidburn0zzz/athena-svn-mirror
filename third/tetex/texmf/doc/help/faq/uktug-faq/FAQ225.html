<head>
<title>UK TeX FAQ -- question 225</title>
</head><body>
<h3>Transcribing LaTeX command definitions</h3>
<p>At several places in this FAQ, questions are answered in terms
of how to program a LaTeX macro.  Sometimes, these macros might
also help users of Plain TeX or other packages; this answer
attempts to provide a rough-and-ready guide to transcribing such macro
definitions for use in other packages.
<p>The reason LaTeX has commands that replace <code>\def</code>, is that
there's a general philosophy within LaTeX that the user should be
protected from himself: the user has different commands according to
whether the command to be defined exists (<code>\renewcommand</code>) or not
(<code>\newcommand</code>), and if its status proves not as the user expected,
an error is reported.  A third definition command,
<code>\providecommand</code>, only defines if the target is not already
defined; LaTeX has no direct equivalent of <code>\def</code>, which ignores
the present state of the command.  The final command of this sort is
<code>\DeclareRobustCommand</code>, which creates a command which is "robust"
(i.e., will not expand if subjected to LaTeX "protected
expansion"); from the Plain TeX user's point of view,
<code>\DeclareRobustCommand</code> should be treated as a non-checking version
of <code>\newcommand</code>.
<p>LaTeX commands are, by default, defined <code>\long</code>; an optional <code>*</code>
between the <code>\newcommand</code> and its (other) arguments specifies that
the command is <em>not</em> to be defined <code>\long</code>.  The <code>*</code> is
detected by a command <code>\@ifstar</code> which uses <code>\futurelet</code> to switch
between two branches, and gobbles the <code>*</code>: LaTeX users are
encouraged to think of the <code>*</code> as part of the command name.
<p>LaTeX's checks for unknown command are done by <code>\ifx</code> comparison
of a <code>\csname</code> construction with <code></code>; since the command name
argument is the desired control sequence name, this proves a little
long-winded.  Since <code>#1</code> is the requisite argument, we have:

<pre>
  \expandafter\ifx
    \csname\expandafter\@gobble\string#1\endcsname
    \relax
      ...
</pre>
(<code>\@gobble</code> simply throws away its argument).
<p>The arguments of a LaTeX command are specified by two optional
arguments to the defining command: a count of arguments (0-9: if the
count is 0, the optional count argument may be omitted), and a default
value for the first argument, if the defined command's first command
is to be optional.  So:
<pre>
\newcommand\foo{...}
\newcommand\foo[0]{...}
\newcommand\foo[1]{...#1...}
\newcommand\foo[2][boo]{...#1...#2...}
</pre>
In the last case, <code>\foo</code> may be called as <code>\foo{goodbye}</code>,
which is equivalent to <code>\foo[boo]{goodbye}</code> (employing the
default value given for the first argument), or as
<code>\foo[hello]{goodbye}</code> (with an explicit first argument).
<p>Coding of commands with optional arguments is exemplified by the
coding of the last <code>\foo</code> above:
<pre>
\def\foo{\futurelet\next\@r@foo}
\def\@r@foo{\ifx\next[%
    \let\next\@x@foo
  \else
    \def\next{\@x@foo[boo]}%
  \fi
  \next
}
\def\@x@foo[#1]#2{...#1...#2...}
</pre>
<p><p><p></body>
