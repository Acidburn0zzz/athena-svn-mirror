

Network Working Group                                       L. Nerenberg
Internet Draft: IMAP4 Binary Content Extension           Orthanc Systems
Document: draft-nerenberg-imap-binary-07.txt               November 2002



                     IMAP4 Binary Content Extension


Status of this Memo

     This document is an Internet Draft and is in full conformance with
     all provisions of Section 10 of RFC 2026.

     Internet Drafts are working documents of the Internet Engineering
     Task Force (IETF), its areas, and its working groups.  Note that
     other groups may also distribute working documents as Internet
     Drafts.

     Internet Drafts are draft documents valid for a maximum of six
     months and may be updated, replaced, or obsoleted by other
     documents at any time.  It is inappropriate to use Internet Drafts
     as reference material or to cite them other than as "work in
     progress."

     The list of current Internet Drafts can be accessed at
     http://www.ietf.org/ietf/1id-abstracts.txt

     The list of Internet Draft Shadow Directories can be accessed at
     http://www.ietf.org/shadow.html.

     A revised version of this draft document will be submitted to the
     RFC editor as a Proposed Standard for the Internet Community.
     Discussion and suggestions for improvement are requested.
     Distribution of this draft is unlimited.


1.  Copyright Notice

     Copyright (C) The Internet Society (2002).  All Rights Reserved.


2.  Abstract

     This memo defines the Binary extension to the Internet Message
     Access Protocol [IMAP4rev1].  It provides a mechanism for IMAP4
     clients and servers to exchange message body data without using a
     MIME content-transfer-encoding.









Nerenberg          draft-nerenberg-imap-binary-07.txt           [Page 1]

Internet Draft       IMAP4 Binary Content Extension        November 2002


3.  Conventions Used in this Document

     The key words "MUST," "MUST NOT," "SHOULD," "SHOULD NOT," and "MAY"
     in this document are to be interpreted as described in [KEYWORD].

     The abbreviation "CTE" means content-transfer-encoding.



4.  Introduction

     The MIME extensions to Internet messaging allow for the
     transmission of non-textual (binary) message content [MIME-IMB].
     Since the traditional transports for messaging are not always
     capable of passing binary data transparently, MIME provides
     encoding schemes that allow binary content to be transmitted over
     transports that are not otherwise able to do so.

     The overhead of MIME encoding this content can be considerable in
     some contexts (e.g. slow radio links, streaming multimedia).
     Reducing the overhead associated with CTE schemes such as base64
     can give a noticeable reduction in resource consumption. The Binary
     extension lets the server perform CTE decoding prior to
     transmitting message data to the client.


5.  Content-Transfer-Encoding Considerations

     Every IMAP4 body section has a MIME content-transfer-encoding.
     (Those without an explicit Content-Transfer-Encoding header are
     implicitly labeled as "7bit" content.) In the terminology of [MIME-
     IMB], the CTE specifies both a decoding algorithm and the domain of
     the decoded data. In this memo, "decoding" refers to the CTE
     decoding step described in [MIME-IMB].

     Certain CTEs use an identity encoding transformation. For these
     CTEs there is no decoding required, however the domain of the
     underlying data may not be expressable in the IMAP4 protocol (e.g.
     MIME "binary" content containing NUL octets).  To accommodate these
     cases the Binary extension introduces a new type of literal
     protocol element that is fully eight bit transparent.

     Thus, server  processing of the FETCH BINARY command involves two
     logical steps:

     1)   perform any CTE-related decoding

     2)   determine the domain of the decoded data

     Step 2 is necessary to determine which protocol element should be
     used to transmit the decoded data. (See FETCH Response Extensions
     for further details.)





Nerenberg          draft-nerenberg-imap-binary-07.txt           [Page 2]

Internet Draft       IMAP4 Binary Content Extension        November 2002


6.  Framework for the IMAP4 Binary Extension

     This memo defines the following extensions to [IMAP4rev1].

6.1.  CAPABILITY Identification

     IMAP4 servers that support this extension MUST include "BINARY" in
     the response list to the CAPABILITY command.

6.2.  FETCH Command Extensions

     This extension defines three new FETCH command data items.

     BINARY<section-binary>[<partial>]

          Requests that the specified section be transmitted after
          performing CTE-related decoding.

          The <partial> argument, if present, requests that a subset of
          the data be returned. The semantics of a partial FETCH BINARY
          command are the same as for a partial FETCH BODY command, with
          the exception that the <partial> arguments refer to the
          DECODED section data.

     BINARY.PEEK<section-binary>[<partial>]

          An alternate form of FETCH BINARY that does not implicitly set
          the \Seen flag.

     BINARY.SIZE<section-binary>

          Requests the decoded size of the section (i.e. the size to
          expect in response to the corresponding FETCH BINARY request).

          Note: client authors are cautioned that this may be an
          expensive operation for some server implementations.
          Needlessly issuing this request could result in degraded
          performance due to servers having to calculate the value every
          time the request is issued.

6.3.  FETCH Response Extensions

     This extension defines two new FETCH response data items.

     BINARY<section-binary>[<<number>>]

          An <nstring> or <literal8> expressing the content of the
          specified section after removing any CTE-related encoding. If
          <number> is present it refers to the offset within the DECODED
          section data.

          If the domain of the decoded data is "8bit" and the data does
          not contain the NUL character, the server SHOULD return the
          data in a <string> instead of a <literal8>; this allows the



Nerenberg          draft-nerenberg-imap-binary-07.txt           [Page 3]

Internet Draft       IMAP4 Binary Content Extension        November 2002


          client to determine if the "8bit" data contains the NUL
          character without having to explicitly scan the data stream
          for NULs.

          If the server does not know how to decode the section's CTE,
          it MUST fail the request and issue a "NO" response that
          contains the "UNKNOWN-CTE" extended response code.


     BINARY.SIZE[<section-binary>]

          The size of the section after removing any CTE-related
          encoding.  The value returned MUST match the size of the
          <nstring> or <literal8> that will be returned by the
          corresponding FETCH BINARY request.

          If the server does not know how to decode the section's CTE,
          it MUST fail the request and issue a "NO" response that
          contains the "UNKNOWN-CTE" extended response code.

6.4.  APPEND Command Extensions

     The APPEND command is extended to allow the client to append data
     containing NULs by using the <literal8> syntax. The server MAY
     modify the CTE of the appended data, however any such
     transformation MUST NOT result in a loss of data.

     If the specified mailbox does not support the storage of binary
     content, the server MUST fail the request and issue a "NO" response
     that contains the "UNKNOWN-CTE" extended response code.


7.  MIME Encoded Headers

     [MIME-MHE] defines an encoding that allows for non-US-ASCII text in
     message headers. This encoding is not the same as the content-
     transfer-encoding applied to message bodies, and the decoding
     transformations described in this memo do not apply to [MIME-MHE]
     encoded header text. A server MUST NOT perform any conversion of
     [MIME-MHE] encoded header text in response to any binary FETCH or
     APPEND request.


8.  Implementation Considerations

     Messaging clients and servers have been notoriously lax in their
     adherence to the Internet CRLF convention for terminating lines of
     textual data in Internet protocols. When sending data using the
     Binary extension, servers MUST ensure that textual line-oriented
     sections are always transmitted using the IMAP4 CRLF line
     termination syntax, regardless of the underlying storage
     representation of the data on the server.

     A server may choose to store message body binary content in a non-



Nerenberg          draft-nerenberg-imap-binary-07.txt           [Page 4]

Internet Draft       IMAP4 Binary Content Extension        November 2002


     encoded format. Regardless of the internal storage representation
     used, the server MUST issue BODYSTRUCTURE responses that describe
     the message as though the binary-encoded sections are encoded in a
     CTE acceptable to the IMAP4 base specification.  Furthermore, the
     results of a FETCH BODY MUST return the message body content in the
     format described by the corresponding FETCH BODYSTRUCTURE response.

     While the server is allowed to modify the CTE of APPENDed
     <literal8> data, this should only be done when it is absolutely
     necessary. Gratuitous encoding changes will render useless most
     cryptographic operations that have been performed on the message.

     This extension provides an optimization that is useful in certain
     specific situations. It does not absolve clients from providing
     basic functionality (content transfer decoding) that should be
     available in all messaging clients.  Clients supporting this
     extension SHOULD be prepared to perform their own CTE decoding
     operations.


9.  Formal Protocol Syntax

     The following syntax specification uses the augmented Backus-Naur
     Form (ABNF) notation as used in [ABNF], and incorporates by
     reference the Core Rules defined in that document.

     This syntax augments the grammar specified in [IMAP4rev1].

     append         =/  "APPEND" SP mailbox [SP flag-list]
                        [SP date-time] SP literal8

     fetch-att      =/  "BINARY" [".PEEK"] section-binary [partial]
                        / "BINARY.SIZE" section-binary

     literal8       =   "~{" number "}" CRLF *OCTET
                        ; <number> represents the number of OCTETs
                        ; in the response string.

     msg-att-static =/  "BINARY" section-binary SP (nstring / literal8)
                        / "BINARY.SIZE" section-binary SP number

     partial        =   "<" number "." nz-number ">"

     resp-text-code =/  "UNKNOWN-CTE"

     section-binary =   "[" [section-part] "]"


10.  Normative References

     [ABNF] Crocker, D., P. Overell, "Augmented BNF for Syntax
     Specifications: ABNF."  RFC2234, November 1997





Nerenberg          draft-nerenberg-imap-binary-07.txt           [Page 5]

Internet Draft       IMAP4 Binary Content Extension        November 2002


     [IMAP4rev1] Crispin, M., "Internet Message Access Protocol Version
     4rev1," Work in progress (son-of-RFC 2060)

     [KEYWORD] Bradner, S., "Key words for use in RFCs to Indicate
     Requirement Levels," BCP 9, RFC2119, March 1997

     [MIME-IMB] Freed, N., N. Borenstein, "Multipurpose Internet Mail
     Extensions (MIME) Part One: Format of Internet Message Bodies,"
     RFC2045, November 1996.

     [MIME-MHE] Moore, K., "MIME (Multipurpose Internet Mail Extensions)
     Part Three: Message Header Extensions for Non-ASCII Text," RFC2047,
     November 1996.


11.  Security Considerations

     There are no known additional security issues with this extension
     beyond those described in the base protocol described in
     [IMAP4rev1].


12.  Intellectual Property

     The IETF takes no position regarding the validity or scope of any
     intellectual property or other rights that might be claimed to
     pertain to the implementation or use of the technology described in
     this document or the extent to which any license under such rights
     might or might not be available; neither does it represent that it
     has made any effort to identify any such rights.  Information on
     the IETF's procedures with respect to rights in standards-track and
     standards-related documentation can be found in BCP-11.  Copies of
     claims of rights made available for publication and any assurances
     of licenses to be made available, or the result of an attempt made
     to obtain a general license or permission for the use of such
     proprietary rights by implementors or users of this specification
     can be obtained from the IETF Secretariat.

     The IETF invites any interested party to bring to its attention any
     copyrights, patents or patent applications, or other proprietary
     rights which may cover technology that may be required to practice
     this standard.  Please address the information to the IETF
     Executive Director.

13.  Authors' Address

     Lyndon Nerenberg
     Orthanc Systems
     508 - 11025 Jasper Avenue
     Edmonton, Alberta
     Canada   T5K 0K7

     Email: lyndon@orthanc.ab.ca




Nerenberg          draft-nerenberg-imap-binary-07.txt           [Page 6]

Internet Draft       IMAP4 Binary Content Extension        November 2002


14.  Full Copyright Statement

     Copyright (C) The Internet Society (2002). All Rights Reserved.

     This document and translations of it may be copied and furnished to
     others, and derivative works that comment on or otherwise explain
     it or assist in its implmentation may be prepared, copied,
     published and distributed, in whole or in part, without restriction
     of any kind, provided that the above copyright notice and this
     paragraph are included on all such copies and derivative works.
     However, this document itself may not be modified in any way, such
     as by removing the copyright notice or references to the Internet
     Society or other Internet organizations, except as needed for the
     purpose of developing Internet standards in which case the
     procedures for copyrights defined in the Internet Standards process
     must be followed, or as required to translate it into languages
     other than English.
     The limited permissions granted above are perpetual and will not be
     revoked by the Internet Society or its successors or assigns.

     This document and the information contained herein is provided on
     an "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET
     ENGINEERING TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR
     IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
     THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
     WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.































Nerenberg          draft-nerenberg-imap-binary-07.txt           [Page 7]

