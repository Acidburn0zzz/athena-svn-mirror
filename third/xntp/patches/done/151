Received: from copland.udel.edu by huey.udel.edu id aa20205; 23 Jun 97 13:35 EDT
Received: from borken.nyc.deshaw.com (root@borken.nyc.deshaw.com [149.77.15.106]) by copland.udel.edu (8.8.5/8.7.3) with ESMTP id NAA29482 for <mills@udel.edu>; Mon, 23 Jun 1997 13:35:24 -0400 (EDT)
Received: from [[UNIX: localhost]] ([[UNIX: localhost]])
 by borken.nyc.deshaw.com (8.8.5/8.7.Alpha.4/1.34.kim) id NAA11862
 for mills@udel.edu; Mon, 23 Jun 1997 13:35:18 -0400 (EDT)
Message-Id: <199706231735.NAA11862@borken.nyc.deshaw.com>
From: Christos Zoulas <christos@deshaw.com>
Date: Mon, 23 Jun 1997 13:35:18 -0400
Organization: D. E. Shaw & Co.
X-Address: Tower 45, 120 West 45th St., 39th Floor, New York, N.Y. 10036
X-Phone: (212) 478 0000
X-Fax: (212) 478 0101
X-Face:  %jL.CVv-*"-d?@xSu)#i[QzHK3,c?Qx,G.u#bZ;O'qSg"$LmB})v;&A"6r&;#2NRahSRwYl
  D9Y8"L97FX^O7oBy?'hA6-1AQA`L(c[yqZySfl/t&4;gHT1|X\ElkgxMV<G<Wl4Bw[Y^/8]X@>NUjM
  /A)InAN\hPuhymGG{1&&ay2c"[4z_*Gb?{gbnv5+?terjcRFl`(^3vO-^Mw%\Cfk`p{@!a3&/NR#*p
  <c]7@{DT)R_*g4#M@G98-f$hN#J<pnDfR:xx<ph,7HcR3TeE|G~&}*>fH0rostE1
X-Mailer: Mail User's Shell (7.2.6 beta(2)+dynamic 2/29/96)
To: mills@udel.edu
Subject: ntptime fixes


Hello,

1. debug is referenced extern in libntp so we need it here
2. progname the same.
3. return in a void main returns a random value to the invocation environment
4. fixes not included, but the html for ntptime is very buggy. I found this
   while I converted it to mandoc...

christos

*** ntptime.c.dist	Mon Jun 23 12:56:31 1997
--- ntptime.c	Mon Jun 23 13:03:31 1997
***************
*** 68,73 ****
--- 68,74 ----
  #endif /* NTP_SYSCALLS_LIBC */
  char *sprintb		P((u_int, char *));
  char *timex_state	P((int));
+ int debug = 0;
  
  #ifdef SIGSYS
  void pll_trap		P((int));
***************
*** 79,86 ****
  
  static volatile int pll_control; /* (0) daemon, (1) kernel loop */
  
! static char* progname;
! static char optargs[] = "ce:f:hm:o:rs:t:";
  
  void
  main(argc, argv)
--- 80,87 ----
  
  static volatile int pll_control; /* (0) daemon, (1) kernel loop */
  
! char* progname;
! static char optargs[] = "cde:f:hm:o:rs:t:";
  
  void
  main(argc, argv)
***************
*** 106,111 ****
--- 107,115 ----
    case 'c':
      cost++;
      break;
+   case 'd':
+     debug++;
+     break;
    case 'e':
      ntx.modes |= MOD_ESTERROR;
      ntx.esterror = atoi(ntp_optarg);
***************
*** 291,297 ****
      printf("  time constant %ld, precision %ld us, tolerance %.0f ppm,\n",
  	   ntx.constant, ntx.precision, ftemp);
      if (ntx.shift == 0)
!       return;
      ftemp = ntx.ppsfreq;
      ftemp /= (1 << SHIFT_USEC);
      gtemp = ntx.stabil;
--- 295,301 ----
      printf("  time constant %ld, precision %ld us, tolerance %.0f ppm,\n",
  	   ntx.constant, ntx.precision, ftemp);
      if (ntx.shift == 0)
! 	exit(0);
      ftemp = ntx.ppsfreq;
      ftemp /= (1 << SHIFT_USEC);
      gtemp = ntx.stabil;
