<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE> IFHP-HOWTO: Installation and Express Configuration</TITLE>
 <LINK HREF="ifhp-3.html" REL=next>
 <LINK HREF="ifhp-1.html" REL=previous>
 <LINK HREF="ifhp.html#toc2" REL=contents>
</HEAD>
<BODY>
<A HREF="ifhp-3.html">Next</A>
<A HREF="ifhp-1.html">Previous</A>
<A HREF="ifhp.html#toc2">Contents</A>
<HR>
<H2><A NAME="s2">2. Installation and Express Configuration</A></H2>

<P>Before you do an installation,
you should read the following instructions.
You will need to:
<OL>
<LI>Use GNU Make.  Don't even think about trying to use another
make unless you are a Wizard.  And even the Wizards would
download the GNU Make.</LI>
<LI>Use an ANSI C compiler.</LI>
<LI>Read the <CODE>HOWTO/ifhp-HOWTO.{ps,html,text,...}</CODE>
file(s).
You are doing this now, so you are off to a good start.</LI>
<LI>Generate the executables.</LI>
<LI>Install the configuration files.</LI>
<LI>Run some simple standalone tests,
i.e. - without using the print spooler.</LI>
<LI>Modify the configuration files to suit your sites requirements.</LI>
<LI>Install the executables.</LI>
<LI>Modify the printcap files and/or add other information to the printcap files.</LI>
<LI>Try the <CODE>ifhp</CODE> filter with the working print spooler.</LI>
</OL>
<P>In addition, you might want to get the following software,
which can be used with
<CODE>ifhp</CODE>.
<DL>
<DT><B>a2ps - Ascii Text To PostScript Converter</B><DD><P>
<A HREF="http://www-inf.enst.fr/~demaille/a2ps/">http://www-inf.enst.fr/~demaille/a2ps/</A>
This package does a very good job of text to PostScript conversion.
<DT><B>enscript - GNU Enscript</B><DD><P>
<A HREF="http://www.gnu.org">http://www.gnu.org/</A>
This package is a simpler version of a2ps,
and is faster and smaller.
<DT><B>Unix File Utility - Determines the type of file</B><DD><P>
<A HREF="ftp://ftp.astron.com/pub/file/">ftp://ftp.astron.com/pub/file/</A> or
<A HREF="ftp://ftp.deshaw.com/pub/file/">ftp://ftp.deshaw.com/pub/file/</A>.
<DT><B>LPRng Print Spooler</B><DD><P>
<A HREF="http://www.astart.com">http://www.astart.com</A></DL>
<H2><A NAME="ss2.1">2.1 Configure and Compilation</A>
</H2>

<P>The <CODE>ifhp</CODE> filter uses the AUTOCONF configuration facilty.
The following set of commands will generate configuration files
and compile and install the software and documentation.
<P>It is highly unlikely that you will encounter problems with compilation.
Usually these are due to type definition conflicts in include files.
If you encounter these,
please report these to the LPRng mailing list.
<BLOCKQUOTE><CODE>
<PRE>
configure
make all
# installs ifhp and textps in /usr/local/lib/filters
# installs ifhp.conf in /etc
#  (if already present, in /etc/ifhp.conf.sample)
make install
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="ss2.2">2.2 Printcap Configuration</A>
</H2>

<P>The basic LPRng printcap configuration is:
<BLOCKQUOTE><CODE>
# printer setup  <BR>
#  force clients (lpr, lpq, to use server)  <BR>
lp:lp=lp@serverhost  <BR>
# server information  <BR>
lp:server  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I>  <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;<BR>
&nbsp;&nbsp;# version 1 - using -T options  <BR>
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp -T<B>options</B>  <BR>
&nbsp;&nbsp;:of=/.../ifhp -T<B>options</B>  <BR>
&nbsp;&nbsp;<BR>
&nbsp;&nbsp;# version 2 - using ifhp printcap entry  <BR>
&nbsp;&nbsp;:ifhp=<B>options</B>  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp  
</CODE></BLOCKQUOTE>
<P>As shown,
options can be passed on the command line using the
<CODE>-Toption,option</CODE>
method or put into the
<CODE>:ifhp=option,option</CODE>
list.
<P>Since commas are used to separate options in the
<CODE>-T</CODE>
option list,
if you want to specify an option with a list of values
the values need to separated with a semicolon
(<CODE>;</CODE>)
as shown below:
<BLOCKQUOTE><CODE>
ifhp -Tconfig=./ifhp.conf;/etc/ifhp.conf;./ifhp.conf
</CODE></BLOCKQUOTE>
<P>By convention,
the
<CODE>ifhp</CODE>
filter takes its input from STDIN (file descriptor 0)
and expects to write its output to STDOUT (file descriptor 1),
which is normally connected to a printer.
Error and trace information are written to STDERR (file descriptor 2).
<P>As shipped,
the
<CODE>ifhp.conf</CODE>
file is configured to support a PJL printer which has
the following configuration.
The configuration flags that support or enable these
features are shown as well.
<OL>
<LI> PJL support (<CODE>pjl</CODE>).</LI>
<LI> PostScript (PS) support (<CODE>ps</CODE>).</LI>
<LI> PCL support (<CODE>pcl</CODE>).</LI>
<LI> Text files printed as PCL (<CODE>text</CODE>, <CODE>default_language=pcl</CODE>).</LI>
<LI> Banner printing done by LPRng spooler (<CODE>banner@</CODE>)</LI>
<LI> Status reported from printer (over bidirectional file descriptor 1)  (<CODE>status</CODE>)</LI>
<LI> Synchronize at start and end (<CODE>sync</CODE>)</LI>
<LI> Get pagecount information (<CODE>pagecount</CODE>)</LI>
</OL>
<P>The following printers have specfic configuration sections
which are invoked by using the
<CODE>model=name</CODE>
option.
The HP DeskJet and DesignJet printers use the same
<CODE>hpdj</CODE> prefix with the model appended.
See Appendix A in the Printer Job Language Technical Reference Manual
for a detailed explanation of these names.
<BLOCKQUOTE><CODE>
<PRE>
apple     hp4000      hp4          hp4l         hp4lc
hp4m      hp4ml       hp4mp        hp4mplus     hp4mv
hp4p      hp4pj       hp4plus      hp4si        hp4simx
hp4v      hp5         hp5l         hp5m         hp5mp
hp5p      hp5si       hp5simopier  hp5simx      hp6l
hp6mp     hp6p        hpcolorlj5   hpcolorlj5m  hpcolorlj
hpdj1200c hpdj1600c   hpdj2000cp   hpdj200      hpdj220
hpdj230   hpdj2500cp  hpdj250c     hpdj330      hpdj350c
hpdj350c  hpdj430     hpdj450c     hpdj455ca    hpdj600
hpdj650c  hpdj700     hpdj750c     hpdj750cplus hpdj755cm
hpiiisi   hpljpro     hppjxl300    postscript   ps
tek       qms1725
</PRE>
</CODE></BLOCKQUOTE>
<P>In addition to HP printers,
there is also generic support for PostScript only printers.
<H2><A NAME="ss2.3">2.3 PS, PCL, PJL Printer with Network Connection</A>
</H2>

<P>This is the most common configuration,
and the printcap entry would have the following format:
<BLOCKQUOTE><CODE>
# printer setup  <BR>
#  force clients (lpr, lpq, to use server)  <BR>
lp:lp=lp@serverhost  <BR>
# server information  <BR>
lp:server  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I>  <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;#:lp=<I>printer ip address or DNS name</I>%9100 <BR>
&nbsp;&nbsp;# eg - :lp=nwpr%9100 <BR>
&nbsp;&nbsp;# eg - :lp=10.1.1.1%9100 <BR>
&nbsp;&nbsp;:lp=10.1.1.1%9100 <BR>
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp
</CODE></BLOCKQUOTE>
<P>If you have an HP printer in the above list,
you can use:
<BLOCKQUOTE><CODE>
# printer setup  <BR>
#  force clients (lpr, lpq, to use server)  <BR>
lp:lp=lp@serverhost  <BR>
# server information  <BR>
lp:server  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I>  <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;:lp=<I>printer ip address or DNS name</I>%9100 <BR>
&nbsp;&nbsp;:ifhp=model=<I>name</I>
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp  
</CODE></BLOCKQUOTE>
<H2><A NAME="ss2.4">2.4 PS, PCL, PJL Printer with Parallel Port Connection</A>
</H2>

<P>Since the parallel port is unidirectional,
you cannot get status back,
and need to use the
<CODE>status@</CODE> option to prevent the
<CODE>ifhp</CODE> filter from expecting it.
The printcap entry would have the following format:
<BLOCKQUOTE><CODE>
# printer setup  <BR>
#  force clients (lpr, lpq, to use server)  <BR>
lp:lp=lp@serverhost  <BR>
# server information  <BR>
lp:server  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I>  <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;# parallel port <BR>
&nbsp;&nbsp;:lp=<I>/dev/lpt</I> <BR>
&nbsp;&nbsp;:ifhp=status@ <BR>
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp  
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss2.5">2.5 PS, PCL, PJL Printer with Serial Port</A>
</H2>

<P>The LPRng print spooler will open and set the serial
line characteristics,
and pass the open connection to the
<CODE>ifhp</CODE> filter.
The 
<CODE>tty</CODE> connection must pass all 8 bits with no parity,
and should use hardware flow control if at all possible.
for your system,
<BLOCKQUOTE><CODE>
# printer setup  <BR>
#  force clients (lpr, lpq, to use server)  <BR>
lp:lp=lp@serverhost  <BR>
# server information  <BR>
lp:server  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I>  <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;# serial port <BR>
&nbsp;&nbsp;:lp=<I>/dev/ttyxxx</I> <BR>
&nbsp;&nbsp;:stty=38400 -echo -crmod -raw -oddp -evenp \ <BR>
&nbsp;&nbsp;   ixon pass8 -ixany cbreak crtscts <BR>
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp  
</CODE></BLOCKQUOTE>
<H2><A NAME="ss2.6">2.6 PostScript Only Printer</A>
</H2>

<P>Use the configuration appropriate to the printer connection,
and then use the
<CODE>pjl@</CODE>, <CODE>pcl@</CODE>, and <CODE>text@</CODE>
option to inhibit everything but PostScript.
<BLOCKQUOTE><CODE>
# printer setup  <BR>
#  force clients (lpr, lpq, to use server)<BR>
lp:lp=lp@serverhost <BR>
# server information  <BR>
lp:server  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I> <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;:ifhp=pcl@,pjl@,text@ <BR>
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp  
</CODE></BLOCKQUOTE>
<P>If you have a parallel port printer with no PostScript support,
you would use:
<BLOCKQUOTE><CODE>
:ifhp=pcl@,pjl@,text@
</CODE></BLOCKQUOTE>
<P>An alternative is to use the
<CODE>model=ps</CODE>
configuration section of the default
<CODE>/etc/ifhp.conf</CODE> file.
<BLOCKQUOTE><CODE>
# printer setup  <BR>
#  force clients (lpr, lpq, to use server)  <BR>
lp:lp=lp@serverhost  <BR>
# server information  <BR>
lp:server  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I>  <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;:ifhp=model=ps
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp  
</CODE></BLOCKQUOTE>
<P>If your printer does not like to have a PostScript EOJ (Control-D)
flag at the start of a job,
use the
<CODE>no_ps_eoj</CODE>
(
<A HREF="ifhp-3.html#no_ps_eoj">No PS EOJ at Start</A>) flags.
flag to remove them.
<H2><A NAME="ss2.7">2.7 PostScript Only Printer With Text Conversion</A>
</H2>

<P>You can use the PostScript Only configuration above,
and add text to postscript conversion to it.
This is done by defining the pathname to a text to PostScript
conversion program and causing ifhp to use the
program to convert the input file to PostScript.
The
<I>a2ps</I>
program can be obtained from
<A HREF="http://www-inf.enst.fr/~demaille/a2ps/">http://www-inf.enst.fr/~demaille/a2ps/</A>
and does an excellent job.
Also,
the
<CODE>textps</CODE>
program included with this distribution does a (barely) adequate job as well.
<P>The method outlined here assumes that the input file
is a text file and that the <CODE>a2ps</CODE> program will convert it.
The
<CODE>a2ps</CODE> program needs to be explicitly told that output
is to go to
<CODE>STDOUT</CODE> or file descriptor 1.
<BLOCKQUOTE><CODE>
<PRE>
text_converter=/usr/local/bin/a2ps -o-
text_converter_output=ps
tempfile=/var/tmp/ifhp
</PRE>
</CODE></BLOCKQUOTE>

<BLOCKQUOTE><CODE>
# printer setup  <BR>
#  force clients (lpr, lpq, to use server)  <BR>
lp:lp=lp@serverhost  <BR>
# server information  <BR>
lp:server  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I>  <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;:ifhp=pcl@,pjl@,text@,text_converter=...,\ <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_converter_output=ps&nbsp;<BR>
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp  
</CODE></BLOCKQUOTE>
<P>
<H2><A NAME="ss2.8">2.8 Tektronixs Phaser Series Printer with Network Connections</A>
</H2>

<P>The Tektronics Phaser Series printers use the
<I>Appsocket</I> protocol when sending a job to the printer.
This protocol is (briefly):
<OL>
<LI> The printer listens for UDP packets on port 9101
and for TCP/IP connections on port 9100.</LI>
<LI> When a UDP packet is recieved on port 9101, then a reply
packet containing the status is returned to the originator's
address.
This packet contains an status indication,
in a <EM>undefined</EM> format.</LI>
<LI> To send a job to the printer,  a TCP/IP connection is opened to port
9100,
and a PostScript job is sent.
Only a single job can be sent at a time - a EOJ (CTRL-D)
will terminate input and flush all following jobs.</LI>
<LI>Return status will be sent in the reverse direction until the job
has completed,
at which point the connection will be closed.</LI>
</OL>
<P>The <CODE>ifhp</CODE> program supports the <CODE>appsocket</CODE> protocol.
In order to do so,
the following ifhp configuration entry can be used.
<BLOCKQUOTE><CODE>
<PRE>
[ tek ]
appsocket
pjl@
pcl@
</PRE>
</CODE></BLOCKQUOTE>

The <CODE>appsocket</CODE> option will use the appsocket protcol,
and cause <CODE>ifhp</CODE> to open and close connections to the printer.
The printcap entry should specify
<CODE>lp=/dev/null</CODE>
and provide the device IP address using the <CODE>-Tdev=host%port</CODE> option.
<BLOCKQUOTE><CODE>
# Phaser Setup
lp:server  <BR>
&nbsp;&nbsp;:<I>lp=/dev/null</I>  <BR>
&nbsp;&nbsp;:sd=<I>spooldir</I>  <BR>
&nbsp;&nbsp;:...  <BR>
&nbsp;&nbsp;:ifhp=model=tek,dev=10.0.0.1%9100<BR>
&nbsp;&nbsp;#path to ifhp filter  <BR>
&nbsp;&nbsp;:if=/.../ifhp  <BR>
&nbsp;&nbsp;:of=/.../ifhp  
</CODE></BLOCKQUOTE>
<P>
<HR>
<A HREF="ifhp-3.html">Next</A>
<A HREF="ifhp-1.html">Previous</A>
<A HREF="ifhp.html#toc2">Contents</A>
</BODY>
</HTML>
