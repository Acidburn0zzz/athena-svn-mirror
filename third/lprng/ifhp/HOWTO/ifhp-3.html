<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE> IFHP-HOWTO: Configuration Tutorial</TITLE>
 <LINK HREF="ifhp-4.html" REL=next>
 <LINK HREF="ifhp-2.html" REL=previous>
 <LINK HREF="ifhp.html#toc3" REL=contents>
</HEAD>
<BODY>
<A HREF="ifhp-4.html">Next</A>
<A HREF="ifhp-2.html">Previous</A>
<A HREF="ifhp.html#toc3">Contents</A>
<HR>
<H2><A NAME="s3">3. Configuration Tutorial</A></H2>

<P>This section is a basic tutorial on using many of the features of
the
<CODE>ifhp</CODE>
filter.
If you plan to make use of any of the advanced filter options or
modify the configuration,
you should read and try out several of the
configuration exercises.
<H2><A NAME="ss3.1">3.1 Configuration Files and Testsupport Directory </A>
</H2>

<P>These exercises require the use of several configuration files
that have predefined values as well as the
default
<CODE>/etc/ifhp.conf</CODE> file.
The test files are normally located in the distribution 
<CODE>testscripts</CODE>
directory.
It is assumed that these exercises will be done in that
directory.
<P>The
<CODE>config=path;path;path</CODE>
option specifies the list of configuration files for
<CODE>ifhp</CODE>
to read.
Here is a sample of the configuration file
<CODE>t1.conf</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
# modify the next line to contain
#  the name, IP address, or pathname of the printer
dev=CHANGE_THIS
debug=3
stty=38400 -echo -crmod -raw -oddp -evenp ixon pass8 -ixany cbreak crtscts
trace
ps@ 
pjl@
pcl@
text
</PRE>
</CODE></BLOCKQUOTE>
<P>The command
<BLOCKQUOTE><CODE>
ifhp -T/etc/ifhp.conf;t1.conf
</CODE></BLOCKQUOTE>

will cause the
<CODE>/etc/ifhp.conf</CODE> and then the
<CODE>t1.conf</CODE> file to be read and configuration information extracted.
<P>The various options in this file are quite important for debugging
and testing.
The
<CODE>debug</CODE>
and
<CODE>trace</CODE>
options can also be specifed on the command line,
and cause the debug facilities to be turned on and debug trace output
to be put to
<CODE>STDERR</CODE>.
Normally,
trace output is written only to the
<CODE>statusfile</CODE>
specified by the command line
<CODE>-s</CODE> option or the configuration file
<CODE>statusfile=path</CODE> entry.
<P>The
<CODE>text</CODE> entry causes the filter to accept text files
and simply pass them through without processing,
and the
<CODE>ps@</CODE>
<CODE>pjl@</CODE>
<CODE>pcl@</CODE>
entries disable related processing.
<H2><A NAME="ss3.2">3.2 Output Device Specification</A>
</H2>

<P>In normal operation,
<CODE>ifhp</CODE>
sends its output to
<CODE>STDOUT</CODE> or file desciptor 2.
However,
when testing or using the
<CODE>ifhp</CODE>
filter in standalone mode,
it is useful to have the filter open the connection
to a file or device directly.
The following sections
discuss how to modify the configuration file to do this,
as well as how to implement a simple
a
<H2><A NAME="ss3.3">3.3 Output to a File</A>
</H2>

<P>This method is useful when trying to debug a set of configuration
options and you want to capture output to a file.
The
<CODE>dev=path</CODE>
option is used to specify the output pathname.
<OL>
<LI>In the
<CODE>testscripts</CODE>
directory,
copy the
<CODE>t1.conf</CODE>
file to
<CODE>ifhp.conf</CODE>
and edit 
<CODE>ifhp.conf</CODE>
so it has the following lines:
<BLOCKQUOTE><CODE>
<PRE>
# dev=/tmp/out
# debug=3
stty=38400 -echo -crmod -raw -oddp -evenp ixon pass8 -ixany cbreak crtscts
trace
ps@ 
pjl@
pcl@
text
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>Run the indicated commands and you should see similar output:
<BLOCKQUOTE><CODE>
<PRE>
##> ifhp -Tconfig=./ifhp.conf &lt; hi.txt
ifhp 12:28:20.603 [6089] Process_job: setting up printer
ifhp 12:28:20.605 [6089] Do_accounting: accounting at start, pagecount 0, pages 0
ifhp 12:28:20.605 [6089] Process_job: sending job file
ifhp 12:28:20.605 [6089] Send_job: starting transfer
Hello World

ifhp 12:28:20.606 [6089] Send_job: finished writing file, cleaning up
ifhp 12:28:20.606 [6089] Process_job: sent job file
ifhp 12:28:20.606 [6089] Process_job: doing cleanup
ifhp 12:28:20.606 [6089] Do_accounting: accounting at end, pagecount 0, pages 0
ifhp 12:28:20.606 [6089] Process_job: done
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>Now modify the
<CODE>ifhp.conf</CODE> file to look like:
<BLOCKQUOTE><CODE>
<PRE>
dev=/tmp/out
debug=3
trace
ps@ 
pjl@
pcl@
text
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>Run indicated commands and you should see similar output:
<BLOCKQUOTE><CODE>
<PRE>
##&gt; ifhp -Tconfig=./ifhp.conf &lt; hi.txt
ifhp 12:33:39.504 [6155] Open_device: device '/tmp/out'
ifhp 12:33:39.505 [6155] Open_device: device '/tmp/out', attempt 1
ifhp 12:33:39.506 [6155] Open_device: success
ifhp 12:33:39.506 [6155] main: fd 1 device 0100000
&nbsp;...
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>Clearly this is very verbose diagnostic or trace output.  However,
if you use
<CODE>cat /tmp/out</CODE>
you will see the output has been written correctly.
Try using the following command to redirect trace and error output
to a file for later examination.
<BLOCKQUOTE><CODE>
<PRE>
CSH                     SH
ifhp ... &lt;in &gt;&amp;out      ifhp ... &lt;in 2&gt;out
</PRE>
</CODE></BLOCKQUOTE>
</LI>
</OL>
<H2><A NAME="ss3.4">3.4 Default ifhp.conf File and Simple CRLF Filter</A>
</H2>

<P>In order to simplify operation,
if there is a
<CODE>ifhp.conf</CODE> file in the current directory,
then the
<CODE>ifhp</CODE> program will read this file first,
followed by
<CODE>/etc/ifhp.conf</CODE>
and then rereads the
<CODE>ifhp.conf</CODE>
This has the effect of extracting critical option information on the
first pass through
<CODE>ifhp.conf</CODE>,
then reading the default information from
<CODE>/etc/ifhp.conf</CODE>,
and finally re-reading
<CODE>ifhp.conf</CODE> to override any defaults. 
<OL>
<LI>Try the simple commands
<BLOCKQUOTE><CODE>
<PRE>
echo >/tmp/out
ifhp &lt;hi.txt
</PRE>
</CODE></BLOCKQUOTE>

and note that it produces the same output as befoe.</LI>
<LI>Now modify the
<CODE>ifhp.conf</CODE> file to contain:
<BLOCKQUOTE><CODE>
<PRE>
dev=/tmp/out
debug=3
trace
ps@ 
pjl@
pcl@
text
crlf
</PRE>
</CODE></BLOCKQUOTE>

and do
<BLOCKQUOTE><CODE>
ifhp &lt;hi.txt
</CODE></BLOCKQUOTE>

again, without clearing the output file.</LI>
<LI>If you examine 
<CODE>/tmp/out</CODE>output using the 
<CODE>od</CODE> or <CODE>hexdump</CODE> file dump programs or the
<CODE>vi</CODE> text editor,
you will find that the LF
(<CODE>\n</CODE>) character has been replaced by
CR LF (<CODE>\r\n</CODE>).</LI>
<LI>You can use the
<CODE>ifhp</CODE>
program as a simple CRLF filter by specifying:
<BLOCKQUOTE><CODE>
ifhp -Tcrlf,language=unknown &lt;hi.txt
</CODE></BLOCKQUOTE>

<P>The
<CODE>language=unknown</CODE> option specifies that the ifhp
program is not to guess at the language type,
and then does CRLF translation.
</LI>
</OL>
<H2><A NAME="ss3.5">3.5 HP Jetdirect or Compatible Network Interface</A>
</H2>

<P>If a printer has HP Jetdirect compatibility,
then the printers TCP/IP port 9100 will accept jobs
for printing and provide printer status.
<P>Other manufacturers make similar products,
and may support equivalent functionality on different ports.
If you are using a Network Printer Box with multiple printer ports,
then each printer port is accessible using a specific TCP/IP port.
For example,
parallel ports P1, P2, and P3 and on a JetDirect box are usually accessed
using TCP/IP ports 9100, 9101, and 9102 respectively.
<P>If you are using a Network Printer Box and are connecting to a
parallel port printer,
then you may not get status or error messages back from the printer
unless both the printer and the Network Printer Box use bi-directional
communication.
<P>In the following discussions,
we will assume that you have assigned an IP address to the printer,
and that it is <CODE>nwpr</CODE>,
and that status and error information is returned over the network
connection.
<OL>
<LI>First,
verify that your printer is accessible on the network by using
<CODE>ping</CODE>.
It is amazing how many problems are caused by erroneous
network addresses.
<BLOCKQUOTE><CODE>
astart: % ping nwpr <BR>
PING nwpr.astart.com (10.0.0.10): 56 data bytes <BR>
64 bytes from 10.0.0.10: icmp_seq=0 ttl=60 time=4.286 ms 
</CODE></BLOCKQUOTE>
</LI>
<LI>Now use
<CODE>telnet</CODE>
to check that you can connect to port 9100.
<BLOCKQUOTE><CODE>
<PRE>
astart: % telnet nwpr 9100
Trying 206.71.174.206...
Connected to nwpr.astart.com.
Escape character is '^]'.
...
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>If you have a PostScript printer,
then you might want to play with the PostScript Interactive mode,
described in
Appendix D.5 of the PostScript Language Reference Manual
by Adobe Systems.
Simply type the command
<BLOCKQUOTE><CODE>
executive
</CODE></BLOCKQUOTE>

as the first characters that are sent.
You should see:
<BLOCKQUOTE><CODE>
<PRE>
>># telnet nwpr
Connected to nwpr.astart.com.
Escape character is '^]'.
executive
PostScript(r) Version 2013.111
(c) Copyright 1984-1993 Adobe Systems Incorporated.
Typefaces (c) Copyright 1981 Linotype-Hell AG and/or its subsidiaries.
All Rights Reserved.
PS>
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>You may want to try sending a simple file to the printer
and examining what happens.
This is easily done using the
<CODE>netcat</CODE>
program  by Mudge.
See
<A HREF="http://www.l0pht.com/~weld/netcat/index.html">http://www.l0pht.com/~weld/netcat/index.html</A>
for general information.</LI>
<LI>The
<CODE>hi.txt</CODE>
file contains
<BLOCKQUOTE><CODE>
Hello World <BR>
^L 
</CODE></BLOCKQUOTE>

where <CODE>^L</CODE> is the form feed character
You can send this file to the printer using:
<BLOCKQUOTE><CODE>
nc printer 9100 &lt;hi.txt
</CODE></BLOCKQUOTE>

<P>The printer should start up and print a single page of output.
You may need to use
<CODE>CTRL-C</CODE> to 
terminate the
<CODE>nc</CODE>
program.
</LI>
<LI>If you have a PostScript printer,
you might try sending a simple PostScript test program to the printer
as well.
The
<CODE>ellipse.ps</CODE>
file can be sent using:
<BLOCKQUOTE><CODE>
nc printer 9100 &lt;/tmp/hi1.txt
</CODE></BLOCKQUOTE>
</LI>
<LI>You can now test the basic
<CODE>ifhp</CODE>
functionality.</LI>
<LI>Copy the
<CODE>t1.conf</CODE>
file to
<CODE>ifhp.conf</CODE>
and edit is so it has the correct network printer information.
<BLOCKQUOTE><CODE>
# modify the next line to contain <BR>
#  the name, IP address, or pathname of the printer
dev=<I>nwpr</I>%9100 <BR>
debug=3 <BR>
trace_to_stderr <BR>
ps@
pjl@
pcl@
text 
</CODE></BLOCKQUOTE>
</LI>
<LI>Now do the indicated command; you should get similar output
<BLOCKQUOTE><CODE>
<PRE>
astart: % ifhp &lt;hi.txt
</PRE>
</CODE></BLOCKQUOTE>

Note the extreme verbosity of output.</LI>
<LI>At this point you might want to try getting page numbers and doing
synchronization.
If you have a HP printer that supports PJL,
then modify
<CODE>t2hp.conf</CODE> as above.
This file has the contents:
<BLOCKQUOTE><CODE>
<PRE>
# modify the next line to contain &lt;newline>
#  the name, IP address, or pathname of the printer
dev=&lt;it/nwpr/%9100 &lt;newline>
#debug=3 &lt;newline>
trace_to_stderr &lt;newline>
text &lt;newline>
pjl &lt;newline>
sync=pjl &lt;newline>
pagecount=pjl &lt;newline>
</PRE>
</CODE></BLOCKQUOTE>

Now use the following command and you should see similar output.
<BLOCKQUOTE><CODE>
<PRE>
ifhp '-Tconfig=t2hp.conf;/etc/ifhp.conf;t2hp.conf' &lt; hi1.txt
ifhp 16:44:16.541 [3199] Process_job: setting up printer
ifhp 16:44:16.545 [3199] Do_sync: starting sync using 'pjl'
ifhp 16:44:17.935 [3199] Check_device_status: device = 'Toner Low'
ifhp 16:44:18.116 [3199] Do_sync: sync done
ifhp 16:44:18.117 [3199] Do_pagecount: getting pagecount using 'pjl'
ifhp 16:44:20.011 [3199] Do_pagecount: final pagecount 63304
ifhp 16:44:20.013 [3199] Do_accounting: accounting at start, pagecount 63304, pages 0
ifhp 16:44:20.013 [3199] Process_job: sending job file
ifhp 16:44:20.014 [3199] Send_job: starting transfer
ifhp 16:44:20.115 [3199] Use_file_util: file identified as 'ascii text ', assigned type 'text'
ifhp 16:44:20.119 [3199] Send_job: finished writing file, cleaning up
ifhp 16:44:20.119 [3199] Process_job: sent job file
ifhp 16:44:20.119 [3199] Process_job: doing cleanup
ifhp 16:44:20.120 [3199] Do_sync: starting sync using 'pjl'
ifhp 16:44:22.175 [3199] Do_sync: sync done
ifhp 16:44:22.176 [3199] Do_waitend: getting end using 'pjl'
ifhp 16:44:22.529 [3199] Check_device_status: device = 'Warming Up'
ifhp 16:45:04.669 [3199] Check_device_status: device = 'Toner Low'
ifhp 16:45:21.361 [3199] Do_pagecount: getting pagecount using 'pjl'
ifhp 16:45:23.241 [3199] Do_pagecount: final pagecount 63305
ifhp 16:45:23.243 [3199] Do_accounting: accounting at end, pagecount 63305, pages 1
ifhp 16:45:23.243 [3199] Process_job: done
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>At this point,
you should be able to send jobs to the printer,
and now need to put these options into the printcap file.
Please see the section on
<A HREF="#finetune">Printcaps and Fine Tuning Configurations</A></LI>
</OL>
<H2><A NAME="ss3.6">3.6 Serial Port</A>
</H2>

<P>If your printer is attached using a serial port,
then you must make sure that the communication channel is
configured correctly.
The
<CODE>dev=/dev/ttyxxx</CODE>
and
<CODE>stty=...</CODE>
configuration options will open the serial port
and configure the line in an appropriate manner.
For details on the exact form of the
<CODE>stty</CODE> options,
please consult the
LPRng-HOWTO documentation.
<OL>
<LI>Copy the
<CODE>t1.conf</CODE>
file to
<CODE>ifhp.conf</CODE> and edit it
so it has the following lines:
<BLOCKQUOTE><CODE>
# modify the next line to contain <BR>
#  the name, IP address, or pathname of the printer
dev=<I>/dev/serialport </I><BR>
#debug=3 <BR>
stty=38400 -echo -crmod -raw -oddp -evenp ixon
pass8 -ixany cbreak crtscts
trace_to_stderr <BR>
text 
</CODE></BLOCKQUOTE>

<P>Now run the
<CODE>ifhp</CODE>
program as shown below.
You should see output similar to:
<BLOCKQUOTE><CODE>
<PRE>
astart: % ifhp &lt;h11.txt
ifhp 15:57:23.734 [3096] Process_job: setting up printer
ifhp 15:57:23.736 [3096] Do_accounting: accounting at start, pagecount 0, pages 0
ifhp 15:57:23.736 [3096] Process_job: sending job file
ifhp 15:57:23.736 [3096] Send_job: starting transfer
ifhp 15:57:23.737 [3096] Send_job: finished writing file, cleaning up
ifhp 15:57:23.737 [3096] Process_job: sent job file
ifhp 15:57:23.738 [3096] Process_job: doing cleanup
ifhp 15:57:23.738 [3096] Do_accounting: accounting at end, pagecount 0, pages 0
ifhp 15:57:23.738 [3096] Process_job: done
</PRE>
</CODE></BLOCKQUOTE>

and you should get a printed page.
</LI>
<LI>If you do not get communication,
then you will have to start a long and painful process of debugging.
First,
check that the various modem control signals
are correct.
You should invest a small amount of time and energy and purchase
a
<B>breakout box</B> that shows the status of the various control signals.
If only the
<B>XMIT Data</B> signal is active,
you will need to put a crossover (null modem)
between the printer and your serial port.
<P>Check the
<B>DTR</B> (Data Terminal Ready),
<B>DCD</B> (Data Carrier Detect),
<B>RTS</B> (Request To Send),
and
<B>CTS</B> (Clear To Send).
These should all be ON or active.
Some systems will use
<B>RTS</B> (Request To Send)
and
<B>CTS</B> (Clear To Send) for
<I>hardware flow control</I>
and it is possible that these signals will become stuck.
It is strongly recommended that flow control on the host be turned off,
and let the printer do flow control using 
<B>RTS</B> and
<B>CTS</B>.
</LI>
<LI>Once you get the basic configuration working,
then you should follow the basic steps in the
previous section on Network Interfaces,
and try sending files of different types.</LI>
</OL>
<H2><A NAME="ss3.7">3.7 Parallel Port</A>
</H2>

<P>The parallel port configuration is the easiest to implement,
but the most limited in abilities.
<OL>
<LI>Copy the
<CODE>t1.conf</CODE>
file to
<CODE>ifhp.conf</CODE> and edit it
so it has the following lines, with the
<CODE>dev</CODE> value replaced by the correct pathname.
<BLOCKQUOTE><CODE>
# modify the next line to contain <BR>
#  the name, IP address, or pathname of the printer <BR>
dev=<I>/dev/lp</I> <BR>
debug=3 <BR>
stty=38400 -echo -crmod -raw -oddp -evenp ixon pass8 -ixany cbreak crtscts <BR>
trace <BR>
ps@ <BR>
pjl@ <BR>
pcl@ <BR>
text <BR>
</CODE></BLOCKQUOTE>
</LI>
<LI>Now run the
<CODE>ifhp</CODE>
program:
<BLOCKQUOTE><CODE>
ifhp &lt;hi.txt
</CODE></BLOCKQUOTE>
</LI>
<LI>You should see output similar to:
<BLOCKQUOTE><CODE>
<PRE>
astart: % ifhp -Tconfig=.../testscripts/t1.conf &lt;h11.txt
ifhp 15:57:23.734 [3096] Process_job: setting up printer
ifhp 15:57:23.736 [3096] Do_accounting: accounting at start, pagecount 0, pages 0
ifhp 15:57:23.736 [3096] Process_job: sending job file
ifhp 15:57:23.736 [3096] Send_job: starting transfer
ifhp 15:57:23.737 [3096] Send_job: finished writing file, cleaning up
ifhp 15:57:23.737 [3096] Process_job: sent job file
ifhp 15:57:23.738 [3096] Process_job: doing cleanup
ifhp 15:57:23.738 [3096] Do_accounting: accounting at end, pagecount 0, pages 0
ifhp 15:57:23.738 [3096] Process_job: done
</PRE>
</CODE></BLOCKQUOTE>

and you should get a printed page.
<P>If you happen to have an operating system that support bi-directional
parallel ports, you can add to the ifhp
<BLOCKQUOTE><CODE>
read_write
</CODE></BLOCKQUOTE>

which will cause ifhp to open the port read/write.
<P>
</LI>
</OL>
<H2><A NAME="finetune"></A> <A NAME="ss3.8">3.8 Fine Tuning A Configuration and Printcap Entries</A>
</H2>

<P>If you have followed the above directions,
you should now be able to use the IFHP filter with
very little additional configuration.
You can now set up your printcap to use the
<CODE>ifhp</CODE> filter.
The following discussion assumes that you are using LPRng.
<H2><A NAME="ss3.9">3.9 ifhp.conf Defaults</A>
</H2>

<P>While the above set of exercises are useful for debugging
and testing,
you should always let the LPRng spooler open the printing device
or make the network connection.
<P>Examine the
<CODE>/etc/ifhp.conf</CODE>
file.
The default configuration is for a HP family printer
which supports pagecounting using PJL,
synchronization using PJL,
and other standard items.
<P>If the default configuration does not meet your needs,
and you do not want to use the printcap
<CODE>:ifhp</CODE>
entry
or pass options using the
<CODE>-T</CODE>
command line entries,
you can create your own entry in a
<CODE>/... spooldir .../ifhp.conf</CODE>
file.
This entry should have the form:
<BLOCKQUOTE><CODE>
<PRE>
option
&nbsp;...
</PRE>
</CODE></BLOCKQUOTE>
<P>For example,
we might want to configure a printer that supports PCL and PostScript,
needs to convert Text to PostScript,
and does not have status capability.
This is similar to an HP3 with a PostScript cartridge on a parallel port.
<BLOCKQUOTE><CODE>
<PRE>
status@
pjl@
pcl
ps
text@
text_converter=/usr/local/bin/a2ps -o-
text_converter_output=ps
</PRE>
</CODE></BLOCKQUOTE>
<P>An alternative to this method is to create a new entry in the
<CODE>/etc/ifhp.conf</CODE>
file and reference this.
This method has the benefit of centralizing management of the
printing configuration.
You usually put such an entry at the end of the
<CODE>/etc/ifhp.conf</CODE>
file,
and it would have the form:
<BLOCKQUOTE><CODE>
<PRE>
[ hp3_parallel ]
status@
pjl@
pcl
ps
text@
text_converter=/usr/local/bin/a2ps -o-
text_converter_output=ps
</PRE>
</CODE></BLOCKQUOTE>
<P>You would modify the printcap so that the model was passed
either in the
<CODE>:ifhp</CODE> information or as a command line option:
<BLOCKQUOTE><CODE>
<PRE>
printer:...&lt;newline>
  :if=/.../ifhp -Tmodel=hp3_parallel&lt;newline>
  :of=/.../ifhp -Tmodel=hp3_parallel&lt;newline>
  # or you can use this
  :ifhp=model=hp3_parallel
</PRE>
</CODE></BLOCKQUOTE>
<H2><A NAME="pcl_user_opts"></A> <A NAME="ps_user_opts"></A> <A NAME="ss3.10">3.10 Extending ifhp Capabilties</A>
</H2>

<P>One problem faced by system administrators
is the need to allow users to configure various options in a job
specific manner.
In order to support this,
the LPRng print spooler passes the
<CODE>lpr -Z</CODE>
command line options through to the print spooler,
where they are used by the
<CODE>ifhp</CODE>
filter.
<P>The details of how these options are used are explained in detail
in the following sections,
but here is an overview of how commands can be added.
<P>The
<CODE>pjl_user_opts=[ ... ]</CODE>,
<CODE>pcl_user_opts=[ ... ]</CODE>,
and
<CODE>ps_user_opts=[ ... ]</CODE>
are options with predefined meanings.
The values of these options specify
<CODE>-Z</CODE>
and
<CODE>-T</CODE>
command line options that will be processed by the
<CODE>ifhp</CODE>
filter when
<CODE>pjl</CODE>, <CODE>pcl</CODE>, or <CODE>ps</CODE> configuration needs to be done.
Here is a sample configuration file section,
and an example.
<BLOCKQUOTE><CODE>
<PRE>
# we add the upper and lower keywords
#  lpr -Zupper  or lpr -Zlower will be specified by the user
pjl_user_opts=[ upper lower ]
pjl_upper=@PJL SET INTRAY=TRAY1
pjl_lower=@PJL SET INTRAY=TRAY2

#  lpr -Zpagesetup
pcl_user_opts=[ pagesetup ]
pcl_pagesetup=[ lines=12 cols=4 ]
lines=20
pcl_lines=\033*(\%{lines}L
cols=2
pcl_cols=\033*(\%{cols}C
</PRE>
</CODE></BLOCKQUOTE>
<P>If the user specifies
<CODE>lpr -Zupper</CODE>,
if
<CODE>PJL</CODE>
is available on the printer
(<CODE>pjl</CODE> is set),
then the
<CODE>-Z</CODE>
option list is scanned for an option that is also in the
<CODE>pjl_user_opts</CODE>.
The
<CODE>upper</CODE>
option is found,
and then the value for
<CODE>pjl_upper</CODE>
is located and sent to the printer.
By prefixing the context or language that is needed,
we can have multiple language dependent actions for the same option.
<P>The
<CODE>lpr -Zpagesetup</CODE>
option is more complex,
mainly due to the range of possibilities the PCL offers.
The
<CODE>pagesetup</CODE>
option is found in the
<CODE>pcl_user_opts</CODE> list,
but when
<CODE>pcl_pagesetup</CODE>
is found,
it turns out to be a list of values.
<P>The list values are expanded in turn,
resulting in
<CODE>pcl_lines</CODE>
and
<CODE>pcl_cols</CODE>
being expanded in turn.
The <CODE>pcl_lines=\033*(\%{lines}L</CODE>
uses the common C/C++/Perl escape sequences,
with the following addition:
<CODE>\%{name}</CODE>
is replaced by the value for the option name found by searching
in order a
a stack of values that have been set by the recursive expansion,
the
<CODE>-Z</CODE> options,
<CODE>-T</CODE> options, 
and the configuration file.
In this example,
we would produce the output string
<BLOCKQUOTE><CODE>
<PRE>
\033*(12L\033*(4C
</PRE>
</CODE></BLOCKQUOTE>
<P>For examples of how to add these commands,
please examine the default
<CODE>/etc/ifhp.conf</CODE>.
<H2><A NAME="no_pcl_eoj"></A> <A NAME="no_ps_eoj"></A> <A NAME="ss3.11">3.11 PCL and PostScript End of Job Sequences</A>
</H2>

<P>One of the more troublesome problems with printing PCL and PostScript
jobs is to initialize the printer when a previous job has failed.
This is commonly done by prefixing a job file with a
<EM>end of job</EM>
sequence for the particular language.
For PostScript,
this the the Control-D (<CODE>\004</CODE>) character,
and for PCL the ESCAPE E (<CODE>\033E</CODE>) sequence.
<P>One problem with using this approach is that when you want to prefix a job
with additional PCL or PostScript,
you need to remove the existing end of job sequences,
or the prefixed commands will have no effect.
By default,
the <CODE>ifhp</CODE>
filter will do this.
In addition,
it will also
prefix the new commands with
an appropriate end of job sequence.
<P>However,
there are certain models of printers which do not like to have
end of job sequences at the start of jobs.
To suppress the prefixing of PostScript jobs with the PostScript end of job,
set the
<CODE>no_ps_eoj</CODE>
flag,
and 
to suppress the prefixing of PCL jobs with the PCL end of job,
set the
<CODE>no_pcl_eoj</CODE>
flag.
<HR>
<A HREF="ifhp-4.html">Next</A>
<A HREF="ifhp-2.html">Previous</A>
<A HREF="ifhp.html#toc3">Contents</A>
</BODY>
</HTML>
