/* 
 * Imakefile for the Athena Login library
 *
 * $Author: cfields $
 * $Id: Imakefile,v 1.6 1996-07-05 01:52:07 cfields Exp $
 *
 * Copyright 1994 by the Massachusetts Institute of Technology.
 * For copying and distribution information, see the file
 * "mit-copyright.h".
 */

SRC=etale.c etalw.c init.c setuser.c passwd.c modify.c group.c \
	start.c homedir.c get_phost.c getrealm.c utmp.c

OBJ=etale.o etalw.o init.o setuser.o passwd.o modify.o group.o \
	start.o homedir.o get_phost.o getrealm.o utmp.o


LIB=-lcom_err -lkrb -ldes -lhesiod

INC=-I..

# We don't want the BSD garbage, and this is the only way I can
# figure out how to get rid of it.
#ifdef _AIX
DEFINES=${INC} ${DEBUG} -U_BSD
#else
DEFINES=${INC} ${DEBUG}
#endif

AnsiCC()

error_table(etale)

error_table(etalw)

build_library(AL,${OBJ})

build_program(testpw,testpw.o,,-L. -lAL ${LIB})
build_program(testgr,testgr.o,,-L. -lAL ${LIB})
build_program(testut,testut.o,,-L. -lAL ${LIB})
build_program(readutmp, readutmp.o,,)
build_program(readwtmp, readwtmp.o,,)

/**/# mkptypes is in the watchmaker locker
ptypes.h: $(SRC)
	$(RM) ptypes.h~
	-mv ptypes.h ptypes.h~
	mkptypes ${SRC} | sed "s/int NOARGS/void/g" > ptypes.h

#if defined(ultrix) || defined(sun)
saber_src:
	/**/#suppress 592	/* unused static */
	/**/#suppress 560	/* assignment within conditional */
	/**/#suppress 530	/* Empty body of statement */
	/**/#load ${DEFINES} -I/usr/athena/include ${SRC}
#else
saber_src:
	/**/#suppress 287
	/**/#suppress 349 in /lib/libc.a   /* _ctype_ redefined as text */
	/**/#load ${DEFINES} -I/usr/athena/include ${SRC}
#endif

saber_lib:
	/**/#load ${DEFINES} -L/usr/athena/lib ${LIB}
