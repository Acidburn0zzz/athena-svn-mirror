Duplicated code in login, xlogin and ftpd is already costing us.
