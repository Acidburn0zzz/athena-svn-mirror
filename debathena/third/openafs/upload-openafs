#!/bin/bash
set -e

: ${DEBATHENA_APT=/mit/debathena/apt}

for i in */; do
    (
	cd $i
	diff -U0 \
	    <(ls *.deb 2>/dev/null | sort) \
	    <(cd $DEBATHENA_APT/pool/openafs/o/openafs && ls *.deb | sort) | \
	    sed -n 's/^-\(.*\)\.deb$/\1/ p' | \
	    xargs -t -n1 -I@ reprepro --ignore=wrongdistribution -Vb $DEBATHENA_APT -C openafs include "$(echo "$i" | sed 's/-[^-]*$//')" @.changes
    )
done
